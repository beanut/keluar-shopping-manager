<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keluar Admin Panel</title>
    <style>
        :root {
            --primary-color: #007bff;
            --primary-hover: #0069d9;
            --danger-color: #dc3545;
            --danger-hover: #c82333;
            --success-color: #28a745;
            --light-gray: #f8f9fa;
            --medium-gray: #e9ecef;
            --dark-gray: #343a40;
            --text-color: #212529;
            --border-radius: 8px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--light-gray);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
        }
        #app-container {
            background: white;
            padding: 30px 40px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
        }
        header { text-align: center; margin-bottom: 30px; }
        header h1 { color: var(--dark-gray); font-size: 28px; }
        nav {
            display: flex;
            gap: 10px;
            border-bottom: 1px solid var(--medium-gray);
            margin-bottom: 30px;
            padding-bottom: 15px;
        }
        .nav-btn {
            padding: 10px 20px;
            border-radius: var(--border-radius);
            border: 1px solid var(--medium-gray);
            background-color: #fff;
            color: var(--dark-gray);
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
        }
        .nav-btn:hover { background-color: #f1f3f5; }
        .nav-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            box-shadow: 0 2px 4px rgba(0, 123, 255, 0.2);
        }
        h2 { margin-top: 40px; border-top: 1px solid var(--medium-gray); padding-top: 30px; text-align: center;}
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; }
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
            box-sizing: border-box;
            font-size: 16px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15);
        }
        textarea { resize: vertical; min-height: 100px; }
        button {
            padding: 15px;
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .btn-primary { width: 100%; background-color: var(--primary-color); }
        .btn-primary:hover:not(:disabled) { background-color: var(--primary-hover); transform: translateY(-1px); }
        .btn-danger { background-color: var(--danger-color); font-size: 14px; padding: 8px 12px; }
        .btn-danger:hover:not(:disabled) { background-color: var(--danger-hover); }
        button:disabled { background-color: #b0c4de; cursor: not-allowed; }
        .status-message { text-align: center; margin-top: 20px; font-weight: bold; min-height: 24px; font-size: 14px; }
        .success { color: var(--success-color); }
        .error { color: var(--error-color); }
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
            margin-bottom: 10px;
        }
        .list-item-info { flex-grow: 1; }
        .list-item-info strong { font-size: 1.1em; color: var(--dark-gray); }
        .list-item-info span { color: #6c757d; font-size: 0.9em; display: block; margin-top: 4px;}
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="app-container">
        <header>
            <h1>Keluar Shopping Management Portal</h1>
        </header>
        <nav>
            <button class="nav-btn active" data-target="add-product-section">Add Product</button>
            <button class="nav-btn" data-target="manage-products-section">Manage Products</button>
            <button class="nav-btn" data-target="manage-promos-section">Manage Promos</button>
        </nav>

        <!-- Section 1: Add Product -->
        <section id="add-product-section" class="content-section active">
            <form id="product-form">
                <div class="form-group"><label for="name">Product Name</label><input type="text" id="name" placeholder="e.g., Modern Velvet Sofa" required></div>
                <div class="form-group"><label for="category">Category</label><input list="category-list" type="text" id="category" placeholder="Select or type a new category" required><datalist id="category-list"></datalist></div>
                <div class="form-group"><label for="price">Price</label><input type="number" id="price" min="0" step="0.01" placeholder="e.g., 599.99" required></div>
                <div class="form-group"><label for="description">Description</label><textarea id="description" placeholder="A brief description of the product." required></textarea></div>
                <div class="form-group"><label for="imageUrl">Image URL</label><input type="url" id="imageUrl" placeholder="https://example.com/image.jpg" required></div>
                <div class="form-group"><label for="rating">Rating (0.0 - 5.0)</label><input type="number" id="rating" min="0" max="5" step="0.1" placeholder="e.g., 4.5"></div>
                <button type="submit" id="add-product-btn" class="btn-primary">Add Product</button>
            </form>
            <p id="add-product-status" class="status-message"></p>
        </section>

        <!-- Section 2: Manage Products -->
        <section id="manage-products-section" class="content-section">
            <div id="product-list-container"></div>
        </section>

        <!-- Section 3: Manage Promo Codes -->
        <section id="manage-promos-section" class="content-section">
            <form id="promo-form">
                <h2>Create New Promo Code</h2>
                <div class="form-group"><label for="promo-code">Promo Code (e.g., WINTER25)</label><input type="text" id="promo-code" required></div>
                <div class="form-group"><label for="discount-type">Discount Type</label><select id="discount-type"><option value="PERCENTAGE">Percentage</option><option value="FIXED">Fixed Amount</option></select></div>
                <div class="form-group"><label for="promo-value">Value (e.g., 25 for % or 10.00 for fixed)</label><input type="number" id="promo-value" min="0" step="0.01" required></div>
                <div class="form-group"><label for="promo-expiry">Expiry Date (optional)</label><input type="date" id="promo-expiry"></div>
                <div class="form-group"><label for="promo-min-value">Minimum Cart Value (optional)</label><input type="number" id="promo-min-value" min="0" step="0.01" placeholder="0.00"></div>
                <button type="submit" id="add-promo-btn" class="btn-primary">Create Promo Code</button>
            </form>
            <p id="add-promo-status" class="status-message"></p>
            <div id="promo-list-container"></div>
        </section>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        const firebaseConfig = {
  apiKey: "AIzaSyDmLhttC8aXZIWoIQM95Id_vPe7gObgkeg",
  authDomain: "keluar-a4469.firebaseapp.com",
  projectId: "keluar-a4469",
  storageBucket: "keluar-a4469.firebasestorage.app",
  messagingSenderId: "578437338277",
  appId: "1:578437338277:web:a3faa6371ea9bffb8ee94c",
  measurementId: "G-21EBQDERCG"
};
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- GLOBAL DOM ELEMENTS ---
        const productForm = document.getElementById('product-form');
        const promoForm = document.getElementById('promo-form');
        const productListContainer = document.getElementById('product-list-container');
        const promoListContainer = document.getElementById('promo-list-container');
        const categoryList = document.getElementById('category-list');
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            setupNavigation();
            loadInitialData();
            setupEventListeners();
        });

        // --- SETUP FUNCTIONS ---
        function setupNavigation() {
            const navButtons = document.querySelectorAll('.nav-btn');
            const contentSections = document.querySelectorAll('.content-section');
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    contentSections.forEach(section => section.classList.remove('active'));
                    button.classList.add('active');
                    document.getElementById(button.dataset.target).classList.add('active');
                });
            });
        }

        function loadInitialData() {
            loadCategories();
            loadProducts();
            loadPromos();
        }

        function setupEventListeners() {
            productForm.addEventListener('submit', handleAddProduct);
            promoForm.addEventListener('submit', handleAddPromo);
            productListContainer.addEventListener('click', handleDelete);
            promoListContainer.addEventListener('click', handleDelete);
        }

        // --- DATA LOADERS ---
        async function loadCategories() {
            try {
                const snapshot = await db.collection('categories').get();
                categoryList.innerHTML = '';
                snapshot.forEach(doc => {
                    const option = document.createElement('option');
                    option.value = doc.data().name;
                    categoryList.appendChild(option);
                });
            } catch (error) { console.error("Error loading categories:", error); }
        }

        async function loadProducts() {
            const snapshot = await db.collection('products').orderBy('name').get();
            renderProductList(snapshot.docs);
        }

        async function loadPromos() {
            const snapshot = await db.collection('promo_codes').orderBy('code').get();
            renderPromoList(snapshot.docs);
        }

        // --- UI RENDERERS ---
        function renderProductList(docs) {
            productListContainer.innerHTML = '<h2>Existing Products</h2>';
            if (docs.length === 0) {
                productListContainer.innerHTML += '<p>No products found.</p>';
                return;
            }
            docs.forEach(doc => {
                const product = doc.data();
                const itemEl = document.createElement('div');
                itemEl.className = 'list-item';
                itemEl.innerHTML = `
                    <div class="list-item-info">
                        <strong>${product.name}</strong>
                        <span>ID: ${product.id} | Category: ${product.category} | Price: ${product.price.toFixed(2)}</span>
                    </div>
                    <button class="btn-danger" data-type="product" data-id="${product.id}">Delete</button>`;
                productListContainer.appendChild(itemEl);
            });
        }

        function renderPromoList(docs) {
            promoListContainer.innerHTML = '<h2>Existing Promo Codes</h2>';
            if (docs.length === 0) {
                promoListContainer.innerHTML += '<p>No promo codes found.</p>';
                return;
            }
            docs.forEach(doc => {
                const promo = doc.data();
                const itemEl = document.createElement('div');
                itemEl.className = 'list-item';
                const expiry = promo.expiresAt ? promo.expiresAt.toDate().toLocaleDateString() : 'No Expiry';
                itemEl.innerHTML = `
                    <div class="list-item-info">
                        <strong>${promo.code}</strong>
                        <span>Type: ${promo.discountType} | Value: ${promo.value} | Expires: ${expiry}</span>
                    </div>
                    <button class="btn-danger" data-type="promo" data-id="${promo.code}">Delete</button>`;
                promoListContainer.appendChild(itemEl);
            });
        }
        
        // --- EVENT HANDLERS ---
        async function handleAddProduct(e) {
            e.preventDefault();
            const btn = document.getElementById('add-product-btn');
            const status = document.getElementById('add-product-status');
            btn.disabled = true;
            status.textContent = 'Submitting...'; status.className = 'status-message';
            try {
                const newProductRef = db.collection('products').doc();
                const productData = {
                    id: newProductRef.id, name: document.getElementById('name').value,
                    category: document.getElementById('category').value.trim(),
                    description: document.getElementById('description').value,
                    imageUrl: document.getElementById('imageUrl').value,
                    price: parseFloat(document.getElementById('price').value) || 0,
                    rating: parseFloat(document.getElementById('rating').value) || 0,
                };
                const categoryName = productData.category;
                const categoryRef = db.collection('categories').doc(categoryName);
                if (!(await categoryRef.get()).exists) {
                    await categoryRef.set({ name: categoryName });
                    await loadCategories();
                }
                await newProductRef.set(productData);
                status.textContent = 'Product added successfully!'; status.className = 'status-message success';
                productForm.reset();
                await loadProducts();
            } catch (error) {
                console.error("Error adding product:", error);
                status.textContent = `Error: ${error.message}`; status.className = 'status-message error';
            } finally { btn.disabled = false; }
        }

        async function handleAddPromo(e) {
            e.preventDefault();
            const btn = document.getElementById('add-promo-btn');
            const status = document.getElementById('add-promo-status');
            btn.disabled = true;
            status.textContent = 'Submitting...'; status.className = 'status-message';
            const code = document.getElementById('promo-code').value.trim().toUpperCase();
            if (!code) {
                status.textContent = 'Promo Code cannot be empty.'; status.className = 'status-message error';
                btn.disabled = false; return;
            }
            try {
                const expiryDate = document.getElementById('promo-expiry').value;
                const promoData = {
                    code: code, discountType: document.getElementById('discount-type').value,
                    value: parseFloat(document.getElementById('promo-value').value) || 0,
                    expiresAt: expiryDate ? firebase.firestore.Timestamp.fromDate(new Date(expiryDate)) : null,
                    minCartValue: parseFloat(document.getElementById('promo-min-value').value) || 0,
                };
                await db.collection('promo_codes').doc(code).set(promoData);
                status.textContent = 'Promo code created successfully!'; status.className = 'status-message success';
                promoForm.reset();
                await loadPromos();
            } catch (error) {
                console.error("Error adding promo code:", error);
                status.textContent = `Error: ${error.message}`; status.className = 'status-message error';
            } finally { btn.disabled = false; }
        }

        async function handleDelete(e) {
            const btn = e.target;
            if (!btn.classList.contains('btn-danger')) return;
            const type = btn.dataset.type;
            const id = btn.dataset.id;
            const collectionName = type === 'product' ? 'products' : 'promo_codes';
            
            if (confirm(`Are you sure you want to delete ${type}: ${id}?`)) {
                btn.disabled = true;
                btn.textContent = 'Deleting...';
                try {
                    await db.collection(collectionName).doc(id).delete();
                    btn.closest('.list-item').remove();
                } catch (error) {
                    console.error(`Error deleting ${type}:`, error);
                    btn.textContent = 'Error!';
                    setTimeout(() => {
                        btn.disabled = false;
                        btn.textContent = 'Delete';
                    }, 2000);
                }
            }
        }
    </script>
</body>
</html>
